import{Y as se,r as o,n as ae,j as e,Z as te,M as re,O as d}from"./index-CJ-wuhK9.js";import{r as F,s as K,u as le,g as oe,d as ne}from"./firebase-bUI-1MSG.js";import{i as ie,I as P}from"./index-uuP-1loQ.js";import{Q as ce,B as de}from"./react-toastify.esm-znZ9rGK_.js";/* empty css                      */import{F as me}from"./index-LTsuns4z.js";import{C as he,a as L}from"./CRow-Cad186SE.js";import{C as pe}from"./CFormCheck-C7IAmBl7.js";import{C as h,a as p}from"./CCardBody-BnIKpIl0.js";import{C as u}from"./CCardHeader-JMdQ0x5M.js";import{C as U}from"./CListGroup-9FGUvHJq.js";import{C as E}from"./CListGroupItem-D7CgEIQF.js";import{a as m}from"./index.esm-Cc_xDpa3.js";import{C as g}from"./CFormInput-CBBV5oX5.js";import{C as ue}from"./CForm-UkVSUVnU.js";import{C as xe,a as je}from"./DefaultLayout-B-qmEVbh.js";import{C as ge,a as fe,b as B,c as be}from"./CTable-DQD40_RL.js";import{C as ke}from"./CFormTextarea-Q98ELNPm.js";import"./iconBase-CEGFQdha.js";import"./CFormControlWrapper-Ctc-jqYh.js";import"./cil-lock-locked-wpvjoNjh.js";import"./cil-user-Ddrdy7PS.js";const $e=()=>{const{taskId:v}=se(),[t,_]=o.useState(null),c=ae(),[r,f]=o.useState(t||{}),[x,V]=o.useState(null),[b,A]=o.useState(""),[k,O]=o.useState(""),[T,D]=o.useState(""),[N,W]=o.useState(""),[w,$]=o.useState("");o.useState("");const[C,S]=o.useState(null);o.useState(null);const[y,I]=o.useState(0);if(o.useEffect(()=>{f(t||{})},[t]),o.useEffect(()=>{(async()=>{try{const a=await te.post("https://redboost-65f83dc8cbf1.herokuapp.com/loadTaskById",{taskId:v});console.log("Task details fetched successfully:",a.data),_(a.data)}catch(a){console.error("Error fetching task details:",a)}})()},[v]),o.useEffect(()=>{const s=async a=>{try{const l=(await c(re(a))).payload;console.log("User Data:",l),V(l)}catch(n){console.error("Error fetching user:",n)}};t&&t.taskOwner&&(console.log("Fetching user data for task owner:",t.taskOwner),s(t.taskOwner))},[t,c]),o.useEffect(()=>{console.log("User State:",x)},[x]),!t)return e.jsx("div",{children:"Loading..."});const z=()=>{if(t.status==="inProgress"&&t.deliverables.length===0){alert("Please add a deliverable before changing the status");return}const s=t.status==="completed"?"inProgress":"completed",a={...t,status:s};c(d({taskId:t._id,taskData:a})),window.location.reload()},j=s=>{de.error(`The ${s} field is required.`,{autoClose:3e3})},G=s=>{window.open(s,"_blank")},H=()=>{if(b==="")return j("KPI Label");if(k==="")return j("KPI Value");const s={...t,kpis:[...t.kpis,{label:b,count:k}]};c(d({taskId:t._id,taskData:s})),window.location.reload()},q=async s=>{if(s.preventDefault(),C){const a=F(K,`deliverables/${C.name}`),n=le(a,C);n.on("state_changed",l=>{const i=parseFloat((l.bytesTransferred/l.totalBytes*100).toFixed(2));I(i)},l=>{console.error("Error uploading file:",l.code,l.message)},async()=>{try{const l=await oe(n.snapshot.ref);console.log("File available at",l);const i={fileName:T,fileUrl:l},R={...r,deliverables:[...r.deliverables,i]};f(R),c(d({taskId:t._id,taskData:R})),D(""),S(null),I(0)}catch(l){console.error("Error getting download URL:",l)}})}},M=async(s,a)=>{try{const n=F(K,a);await ne(n),console.log("File deleted successfully from Firebase Storage."),f(l=>({...l,deliverables:l.deliverables.filter(i=>i.id!==s)}))}catch(n){console.error("Error deleting file:",n)}window.location.reload()},Q=s=>{const a=r.reports.filter((l,i)=>i!==s),n={...r,reports:a};c(d({taskId:t._id,taskData:n})),window.location.reload()},Y=()=>{if(N==="")return j("Rapport Title");if(w==="")return j("Rapport Text");const s={...t,reports:[...t.reports,{label:N,count:w}]};c(d({taskId:t._id,taskData:s})),window.location.reload()},Z=s=>{const a=r.kpis.filter((l,i)=>i!==s),n={...r,kpis:a};c(d({taskId:t._id,taskData:n})),window.location.reload()},J=s=>{const a=["primary","secondary","success","danger","warning","info","light","dark"];return a[s%a.length]},X=s=>!isNaN(Date.parse(s)),ee=s=>X(s)?new Date(s).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}):"";return e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsxs(he,{children:[e.jsx(L,{children:e.jsx("div",{className:"card mb-3",style:{maxWidth:"540px"},children:e.jsxs("div",{className:"row g-0",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("img",{src:ie,alt:"Trendy Pants and Shoes",className:"img-fluid rounded-start"})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Task Details"}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Name:"})," ",r.taskName]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Owner:"})," ",x?x.username||"Unknown":"Loading..."]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Target Date:"})," ",r.endDate?ee(r.endDate):"No target date set"]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),r.status==="inProgress"?e.jsx(pe,{className:"mb-3",style:{display:t.status==="notStarted"?"none":"block"},id:"flexCheckChecked",label:"I have Completed The Task",checked:t.status==="completed",onChange:z}):e.jsxs("p",{className:" text-center text-success",children:["this Task is ",r.status]})]})})]})})}),e.jsx(L,{children:e.jsxs(h,{children:[e.jsx(u,{className:"bg-dark text-light",children:"Resources"}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsxs("h5",{children:[r.taskName," Resources:"]}),e.jsx(U,{children:r.resources&&r.resources.map((s,a)=>e.jsx(E,{children:e.jsx(m,{href:s.url,download:!0,color:"link",children:s.fileName})},a))})]})})]})})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-dark text-light",children:"Sections"}),e.jsxs(p,{children:[e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"KPIs"}),e.jsxs(p,{children:[e.jsx(E,{children:e.jsxs("div",{className:"form-group d-flex align-items-center mt-3 mb-3",children:[e.jsx("label",{htmlFor:"newKpiLabel",className:"me-2",children:"Label:"}),e.jsx(g,{id:"newKpiLabel",placeholder:"KPI Label",value:b,onChange:s=>A(s.target.value),className:"me-3",style:{maxWidth:"200px"}}),e.jsx("label",{htmlFor:"newKpiValue",className:"me-2",children:"Value:"}),e.jsx(g,{id:"newKpiValue",placeholder:"KPI Value",value:k,onChange:s=>O(s.target.value),className:"me-3",style:{maxWidth:"150px"}}),e.jsx(m,{style:{backgroundColor:"#00cc99"},onClick:()=>H(),children:"Add KPI"})]})}),e.jsx(U,{children:e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"#"}),e.jsx("th",{scope:"col",children:"KPI Label"}),e.jsx("th",{scope:"col",children:"KPI Value"}),e.jsx("th",{scope:"col",children:"Actions"})]})}),e.jsx("tbody",{children:r.kpis&&r.kpis.map((s,a)=>e.jsxs("tr",{children:[e.jsxs("th",{scope:"row",children:["KPI-",a]}),e.jsx("td",{children:s.label}),e.jsx("td",{children:s.count}),e.jsx("td",{children:e.jsx(P,{onClick:()=>Z(a),style:{cursor:"pointer",color:"red"}})})]},a))})]})})]})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"Documents"}),e.jsxs(p,{children:[e.jsxs(ue,{onSubmit:q,className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx(g,{id:"newDeliverableName",placeholder:"Deliverable Name",value:T,onChange:s=>D(s.target.value),className:"me-2"}),e.jsx("input",{id:"newDeliverableFile",name:"deliverableFile",type:"file",onChange:s=>{console.log("Selected deliverable file:",s.target.files[0]),S(s.target.files[0])},className:"me-2"}),e.jsx(m,{style:{backgroundColor:"#00cc99"},type:"submit",children:"Add Deliverable"})]}),y>0&&e.jsx(xe,{className:"mt-2 mb-3",style:{height:"20px"},children:e.jsxs(je,{value:y,color:"success",animated:!0,striped:!0,className:"text-center",children:[y,"%"]})}),e.jsxs(ge,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(fe,{children:e.jsxs(B,{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Actions"})]})}),e.jsx(be,{children:r.deliverables&&r.deliverables.map((s,a)=>e.jsxs(B,{children:[e.jsx("td",{children:s.fileName}),e.jsxs("td",{children:[e.jsx(m,{onClick:()=>G(s.fileUrl),color:"link",className:"d-inline-flex align-items-center",children:"Download"}),e.jsx(m,{color:"warning",className:"ms-2",children:e.jsx(me,{style:{fontSize:"16px"},onClick:n=>{n.stopPropagation(),M(s.id,s.fileUrl)}})})]})]},a))})]})]})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"Reporting Section"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",padding:"20px"},children:r.reports&&r.reports.map((s,a)=>e.jsxs("div",{style:{minWidth:"300px",margin:"10px"},className:`card radius-10 border-start border-0 border-3 border-${J(a)} shadow`,children:[e.jsx(P,{onClick:()=>Q(a),style:{position:"absolute",top:"0",right:"0",fontSize:"20px",margin:"5px",cursor:"pointer"}}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-0 text-secondary",children:s.label}),e.jsx("p",{className:"mb-0 font-13",children:s.count})]}),e.jsx("div",{className:"widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto",children:e.jsx("i",{className:"fa fa-bar-chart"})})]})})]}))}),e.jsxs(p,{children:[e.jsx(g,{placeholder:"Title",value:N,onChange:s=>W(s.target.value),className:"mb-3"}),e.jsx(ke,{placeholder:"Text",value:w,onChange:s=>$(s.target.value),className:"mt-3 mb-3"}),e.jsx(m,{style:{backgroundColor:"#00cc99"},onClick:()=>Y(),className:"mt-3 mb-3",children:"Add Reporting Section"})]})]})]})]})]})};export{$e as default};
