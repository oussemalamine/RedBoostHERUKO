import{a6 as N,r as a,j as r,H as u,k as D}from"./index-CJ-wuhK9.js";import{c as F}from"./index.esm-Cc_xDpa3.js";import{C as S,a as L}from"./CCardBody-BnIKpIl0.js";import{C as b}from"./CCardHeader-JMdQ0x5M.js";import{C as B}from"./CListGroup-9FGUvHJq.js";import{C as x}from"./CListGroupItem-D7CgEIQF.js";import{q as H}from"./DefaultLayout-B-qmEVbh.js";import"./cil-lock-locked-wpvjoNjh.js";import"./cil-user-Ddrdy7PS.js";var M=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M472,472H40a24.028,24.028,0,0,1-24-24V64A24.028,24.028,0,0,1,40,40H226.667a23.935,23.935,0,0,1,22.154,14.77L269.333,104H472a24.028,24.028,0,0,1,24,24V448A24.028,24.028,0,0,1,472,472ZM48,440H464V136H248L221.333,72H48Z' class='ci-primary'/>"];const z=()=>{const o=N.useSession(),[n,f]=a.useState([]),[g,l]=a.useState(!0),[c,i]=a.useState(null),[d,m]=a.useState("root"),[p,h]=a.useState([{id:"root",name:"My Drive"}]);a.useEffect(()=>{o!=null&&o.provider_token&&j(d)},[o,d]);const j=async e=>{try{l(!0),i(null);const s=`'${e}' in parents and trashed = false`,t=await fetch("https://www.googleapis.com/drive/v3/files?"+new URLSearchParams({q:s,fields:"files(id, name, mimeType, iconLink, webViewLink, modifiedTime, size)",orderBy:"folder,name",pageSize:100}),{headers:{Authorization:`Bearer ${o.provider_token}`}});if(!t.ok)throw new Error("Failed to fetch Drive contents");const k=await t.json();f(k.files)}catch(s){console.error("Error loading Drive contents:",s),i(s.message)}finally{l(!1)}},v=async(e,s)=>{m(e),h(t=>[...t,{id:e,name:s}])},C=e=>{const s=p.slice(0,e+1);h(s),m(s[s.length-1].id)},w=e=>{if(!e)return"";const s=["Bytes","KB","MB","GB","TB"],t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(2)} ${s[t]}`},y=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return o?r.jsxs(S,{children:[r.jsx(b,{children:r.jsx("div",{className:"d-flex align-items-center",children:r.jsx("h3",{className:"mb-0",children:"Google Drive"})})}),r.jsxs(L,{children:[c&&r.jsx(u,{color:"danger",dismissible:!0,onClose:()=>i(null),children:c}),r.jsx("div",{className:"folder-path mb-3",children:p.map((e,s)=>r.jsxs("span",{children:[s>0&&" > ",r.jsx("button",{className:"btn btn-link p-0",onClick:()=>C(s),children:e.name})]},e.id))}),g?r.jsx("div",{className:"text-center p-3",children:r.jsx(D,{color:"primary"})}):r.jsx(B,{children:n.length===0?r.jsx(x,{className:"text-center text-muted",children:"This folder is empty"}):n.map(e=>r.jsxs(x,{className:"d-flex align-items-center",action:!0,onClick:()=>e.mimeType==="application/vnd.google-apps.folder"?v(e.id,e.name):window.open(e.webViewLink,"_blank"),children:[r.jsx(F,{icon:e.mimeType==="application/vnd.google-apps.folder"?M:H,className:"me-2"}),r.jsxs("div",{className:"ms-2 me-auto",children:[r.jsx("div",{className:"fw-bold",children:e.name}),r.jsxs("small",{className:"text-muted",children:[y(e.modifiedTime),e.size&&` â€¢ ${w(e.size)}`]})]})]},e.id))})]})]}):r.jsx(u,{color:"warning",children:"Please sign in to access your Google Drive"})};function _(){return r.jsx(r.Fragment,{children:r.jsx(z,{})})}export{_ as default};
