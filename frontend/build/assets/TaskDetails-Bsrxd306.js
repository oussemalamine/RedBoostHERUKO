import{Y as H,r,n as M,j as e,O as T,K as Q,M as g}from"./index-liV4V1Uq.js";import{i as Y,C as v,I as S,a as J}from"./index-CcEBYOKw.js";import{Q as X,B as I}from"./ReactToastify-YsGnr0bX.js";import{C as Z,a as F}from"./CRow-B6SVFXtW.js";import{C as ee}from"./CFormCheck-C1GXd4K3.js";import{C as o,a as c}from"./CCardBody-D7cJFJkR.js";import{C as d}from"./CCardHeader-rLMJK4e8.js";import{C as f}from"./CListGroupItem-C2nlnhox.js";import{a as h}from"./index.es-smJaQxJq.js";import{C as b}from"./CFormInput-BZZhJW11.js";import{C as se}from"./CForm-Dvrw1di_.js";import{C as ae}from"./CFormTextarea-C0q6I-1v.js";import"./iconBase-D_QDNYIQ.js";const je=()=>{const{taskId:y}=H(),[t,K]=r.useState(null),n=M(),[l,P]=r.useState(t||{}),[p,R]=r.useState(null),[N,L]=r.useState(""),[k,U]=r.useState(""),[x,E]=r.useState(""),[C,V]=r.useState(""),[w,A]=r.useState("");r.useState("");const[u,B]=r.useState(null);if(r.useEffect(()=>{P(t||{})},[t]),r.useEffect(()=>{(async()=>{try{const a=await T.post("https://redboost-65f83dc8cbf1.herokuapp.com/loadTaskById",{taskId:y});console.log("Task details fetched successfully:",a.data),K(a.data)}catch(a){console.error("Error fetching task details:",a)}})()},[y]),r.useEffect(()=>{const s=async a=>{try{const j=(await n(Q(a))).payload;console.log("User Data:",j),R(j)}catch(m){console.error("Error fetching user:",m)}};t&&t.taskOwner&&(console.log("Fetching user data for task owner:",t.taskOwner),s(t.taskOwner))},[t,n]),r.useEffect(()=>{console.log("User State:",p)},[p]),!t)return e.jsx("div",{children:"Loading..."});const _=()=>{if(t.status==="inProgress"&&t.deliverables.length===0){alert("Please add a deliverable before changing the status");return}const s=t.status==="completed"?"inProgress":"completed",a={...t,status:s};n(g({taskId:t._id,taskData:a})),window.location.reload()},i=s=>{I.error(`The ${s} field is required.`,{autoClose:3e3})},O=s=>{window.open(s,"_blank")},W=()=>{if(N==="")return i("KPI Label");if(k==="")return i("KPI Value");const s={...t,kpis:[...t.kpis,{label:N,count:k}]};n(g({taskId:t._id,taskData:s})),window.location.reload()},$=async s=>{if(s.preventDefault(),x==="")return i("Deliverable Name");if(!u)return i("Deliverable File");try{const a=new FormData;a.append("file",u),console.log("Uploading file:",u);const m=await T.post("https://redboost-65f83dc8cbf1.herokuapp.com/upload",a,{headers:{"Content-Type":"multipart/form-data"}});console.log("Upload response:",m.data);const j={...t,deliverables:[...t.deliverables,{fileName:x||u.name,fileUrl:m.data.secure_url}]};n(g({taskId:t._id,taskData:j})),window.location.reload()}catch(a){console.error("Error uploading file:",a),I.error("Failed to upload file. Please try again.")}},G=()=>{if(C==="")return i("Rapport Title");if(w==="")return i("Rapport Text");const s={...t,reports:[...t.reports,{label:C,count:w}]};n(g({taskId:t._id,taskData:s})),window.location.reload()},D=s=>{const a=["primary","secondary","success","danger","warning","info","light","dark"];return a[s%a.length]},q=s=>!isNaN(Date.parse(s)),z=s=>q(s)?new Date(s).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}):"";return e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsxs(Z,{children:[e.jsx(F,{children:e.jsx("div",{className:"card mb-3",style:{maxWidth:"540px"},children:e.jsxs("div",{className:"row g-0",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("img",{src:Y,alt:"Trendy Pants and Shoes",className:"img-fluid rounded-start"})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Task Details"}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Name:"})," ",l.taskName]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Owner:"})," ",p?p.username||"Unknown":"Loading..."]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Target Date:"})," ",l.endDate?z(l.endDate):"No target date set"]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Status:"})," ",l.status]}),l.status==="inProgress"?e.jsx(ee,{className:"mb-3",style:{display:t.status==="notStarted"?"none":"block"},id:"flexCheckChecked",label:"I have Completed The Task",checked:t.status==="completed",onChange:_}):e.jsxs("p",{className:" text-center text-success",children:["this Task is ",l.status]})]})})]})})}),e.jsx(F,{children:e.jsxs(o,{children:[e.jsx(d,{className:"bg-dark text-light",children:"Resources"}),e.jsx(c,{children:e.jsxs("div",{children:[e.jsxs("h5",{children:[l.taskName," Resources:"]}),e.jsx(v,{children:l.resources&&l.resources.map((s,a)=>e.jsx(f,{children:e.jsx(h,{href:s.url,download:!0,color:"link",children:s.fileName})},a))})]})})]})})]}),e.jsxs(o,{className:"mt-3 mb-3",children:[e.jsx(d,{className:"bg-dark text-light",children:"Sections"}),e.jsxs(c,{children:[e.jsxs(o,{className:"mt-3 mb-3",children:[e.jsx(d,{className:"bg-info text-light",children:"KPIs"}),e.jsx(c,{children:e.jsxs(v,{children:[e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center"},children:l.kpis&&l.kpis.map((s,a)=>e.jsxs("div",{className:`card text-bg-${D(a)} mb-3`,style:{minWidth:"260px",marginRight:"10px"},children:[e.jsxs("div",{className:"card-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["KPI-",a," ",e.jsx(S,{})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:s.label}),e.jsx("p",{className:"card-text",children:s.count})]})]},a))}),e.jsxs(f,{children:[e.jsx("label",{htmlFor:"newKpiLabel",children:"Label:"}),e.jsx(b,{id:"newKpiLabel",placeholder:"KPI Label",value:N,onChange:s=>L(s.target.value),className:"mt-3 mb-3"}),e.jsx("label",{htmlFor:"newKpiValue",children:"Value:"}),e.jsx(b,{id:"newKpiValue",placeholder:"KPI Value",value:k,onChange:s=>U(s.target.value),className:"mt-3 mb-3"}),e.jsx(h,{style:{backgroundColor:"#00cc99"},onClick:()=>W(),className:"mt-3 mb-3",children:"Add KPI"})]})]})})]}),e.jsxs(o,{className:"mt-3 mb-3",children:[e.jsx(d,{className:"bg-info text-light",children:"Documents"}),e.jsx(c,{children:e.jsxs(v,{children:[l.deliverables&&l.deliverables.map((s,a)=>e.jsx(f,{children:e.jsx(h,{onClick:()=>O(s.fileUrl),color:"link",children:s.fileName})},a)),e.jsx(f,{children:e.jsxs(se,{onSubmit:$,children:[e.jsx("label",{htmlFor:"newDeliverableName",children:"Name:"}),e.jsx(b,{id:"newDeliverableName",placeholder:"Deliverable Name",value:x,onChange:s=>E(s.target.value)}),e.jsx("label",{htmlFor:"newDeliverableFile",className:"mt-3 mb-3",children:"Upload File:"}),e.jsx("input",{id:"newDeliverableFile",name:"deliverableFile",type:"file",onChange:s=>{console.log("Selected deliverable file:",s.target.files[0]),B(s.target.files[0])}}),e.jsx(h,{style:{backgroundColor:"#00cc99"},type:"submit",className:"mt-3 mb-3",children:"Add Deliverable"})]})})]})})]}),e.jsxs(o,{className:"mt-3 mb-3",children:[e.jsx(d,{className:"bg-info text-light",children:"Reporting Section"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",padding:"20px"},children:l.reports&&l.reports.map((s,a)=>e.jsxs("div",{style:{minWidth:"300px",margin:"10px"},className:`card radius-10 border-start border-0 border-3 border-${D(a)} shadow`,children:[e.jsx(S,{style:{position:"absolute",top:"0",right:"0",fontSize:"20px",margin:"5px"}}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-0 text-secondary",children:s.label}),e.jsx("p",{className:"mb-0 font-13",children:s.count})]}),e.jsx("div",{className:"widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto",children:e.jsx("i",{className:"fa fa-bar-chart"})})]})})]}))}),e.jsxs(c,{children:[e.jsx(b,{placeholder:"Title",value:C,onChange:s=>V(s.target.value),className:"mb-3"}),e.jsx(ae,{placeholder:"Text",value:w,onChange:s=>A(s.target.value),className:"mt-3 mb-3"}),e.jsx(h,{style:{backgroundColor:"#00cc99"},onClick:()=>G(),className:"mt-3 mb-3",children:"Add Reporting Section"})]})]}),e.jsxs(o,{className:"mt-3 mb-3",children:[e.jsx(d,{className:"bg-info text-light",children:"Comment Section"}),e.jsx(c,{children:e.jsx(J,{})})]})]})]})]})};export{je as default};
