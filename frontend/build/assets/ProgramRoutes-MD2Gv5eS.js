import{h as K,j as e,n as W,r as n,K as ge,M as V,g as fe,O as Ne,Q as ye,l as re,m as B,S as ve,U as Ce}from"./index-C8diSxJB.js";import we from"./Program-1bUtVzXe.js";import{r as me,s as he,u as ke,g as Te,d as De}from"./firebase-DfqT8Rqk.js";import{i as Se,C as se,I as xe}from"./index-BFW_OZiL.js";import{Q as Pe,B as Fe}from"./ReactToastify-CywJzNmS.js";import{F as Ie}from"./index-Dio9L0x0.js";import{C as L,a as S}from"./CRow-BLE2Ph6C.js";import{C as _e}from"./CFormCheck-BdWIrEfk.js";import{C as k,a as T}from"./CCardBody-CrmRxOrF.js";import{C as D}from"./CCardHeader-B8sPIN-d.js";import{C as M}from"./CListGroupItem-C8JO_jfS.js";import{a as b,b as Re,c as ae}from"./index.esm-14PgRZM7.js";import{C as y}from"./CFormInput-Cy6DlF7x.js";import{C as Le}from"./CForm-B6uC-7r3.js";import{C as Ae,a as Ee,b as ie,c as ce,d as ne,e as oe,f as be}from"./DefaultLayout-C4vGQpA-.js";import{C as Ue}from"./CFormTextarea-3JMbwrs6.js";import{H as Ve}from"./index-CdkZfHGa.js";import{C as Be}from"./index.esm-BNEz7vpG.js";import{b as Ke,c as He}from"./index-CggS_cir.js";import{C as te}from"./CInputGroup-BL5k9uJS.js";import{C as ue}from"./CInputGroupText-K3jeKe2o.js";import{C as Oe}from"./CFormSelect-KwR2mgFv.js";import{C as Me,a as $e,b as pe,c as $,d as qe,e as q}from"./CTable-5MXWBY_Y.js";import{C as We,a as le}from"./CPaginationItem-BFEzZckZ.js";import{c as ze}from"./cil-user-Ddrdy7PS.js";import"./iconBase-DEK5PW2A.js";import"./index-DlbWxFkW.js";import"./CTooltip-Dq5_9fu_.js";import"./isObject-gWhhM0FN.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";import"./CFormControlWrapper-5hdytq66.js";import"./chart-BCuMZI75.js";var je=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M472,96H384V40H352V96H160V40H128V96H40a24.028,24.028,0,0,0-24,24V456a24.028,24.028,0,0,0,24,24H472a24.028,24.028,0,0,0,24-24V120A24.028,24.028,0,0,0,472,96Zm-8,352H48V128h80v40h32V128H352v40h32V128h80Z' class='ci-primary'/><rect width='32' height='32' x='112' y='224' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='200' y='224' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='280' y='224' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='368' y='224' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='112' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='200' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='280' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='368' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='112' y='368' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='200' y='368' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='280' y='368' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='368' y='368' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/>"];function Ge(){const l=K(a=>a.userData.userData);return e.jsx("div",{className:"container my-5 py-5",style:{maxWidth:"100%"},children:e.jsx("div",{className:"row d-flex justify-content-center",children:e.jsx("div",{className:"col-md-12 col-lg-10 col-xl-12",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-body",style:{overflow:"auto",maxHeight:"300px"},children:[e.jsxs("div",{className:"card-container",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"d-flex flex-start align-items-center",children:[e.jsx("img",{className:"rounded-circle shadow-1-strong me-3",src:"https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp",alt:"avatar",width:"60",height:"60"}),e.jsxs("div",{children:[e.jsx("h6",{className:"fw-bold text-primary mb-1",children:"Lily Coleman"}),e.jsx("p",{className:"text-muted small mb-0",children:"Shared publicly - Jan 2020"})]})]}),e.jsx("p",{className:"mt-3 mb-4 pb-2",children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip consequat."}),e.jsxs("div",{className:"small d-flex justify-content-start",children:[e.jsxs("a",{href:"#!",className:"d-flex align-items-center me-3",children:[e.jsx("i",{className:"far fa-thumbs-up me-2"}),e.jsx("p",{className:"mb-0",children:"Like"})]}),e.jsxs("a",{href:"#!",className:"d-flex align-items-center me-3",children:[e.jsx("i",{className:"far fa-comment-dots me-2"}),e.jsx("p",{className:"mb-0",children:"Comment"})]}),e.jsxs("a",{href:"#!",className:"d-flex align-items-center me-3",children:[e.jsx("i",{className:"fas fa-share me-2"}),e.jsx("p",{className:"mb-0",children:"Share"})]})]})]}),e.jsxs("div",{className:"card-container",children:[e.jsxs("div",{className:"d-flex flex-start align-items-center",children:[e.jsx("img",{className:"rounded-circle shadow-1-strong me-3",src:"https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp",alt:"avatar",width:"60",height:"60"}),e.jsxs("div",{children:[e.jsx("h6",{className:"fw-bold text-primary mb-1",children:"Lily Coleman"}),e.jsx("p",{className:"text-muted small mb-0",children:"Shared publicly - Jan 2020"})]})]}),e.jsx("p",{className:"mt-3 mb-4 pb-2",children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip consequat."}),e.jsxs("div",{className:"small d-flex justify-content-start",children:[e.jsxs("a",{href:"#!",className:"d-flex align-items-center me-3",children:[e.jsx("i",{className:"far fa-thumbs-up me-2"}),e.jsx("p",{className:"mb-0",children:"Like"})]}),e.jsxs("a",{href:"#!",className:"d-flex align-items-center me-3",children:[e.jsx("i",{className:"far fa-comment-dots me-2"}),e.jsx("p",{className:"mb-0",children:"Comment"})]}),e.jsxs("a",{href:"#!",className:"d-flex align-items-center me-3",children:[e.jsx("i",{className:"fas fa-share me-2"}),e.jsx("p",{className:"mb-0",children:"Share"})]})]})]})]}),e.jsxs("div",{className:"card-footer py-3 border-0",style:{backgroundColor:"#f8f9fa"},children:[e.jsxs("div",{className:"d-flex flex-start w-100",children:[e.jsx("img",{className:"rounded-circle shadow-1-strong me-3",src:l.image,alt:"avatar",width:"40",height:"40"}),e.jsxs("div",{"data-mdb-input-init":!0,className:"form-outline w-100",children:[e.jsx("textarea",{className:"form-control",id:"textAreaExample",rows:"4",style:{background:"#fff"}}),e.jsx("label",{className:"form-label",htmlFor:"textAreaExample",children:"Message"})]})]}),e.jsxs("div",{className:"float-end mt-2 pt-1",children:[e.jsx("button",{type:"button","data-mdb-button-init":!0,"data-mdb-ripple-init":!0,className:"btn btn-primary btn-sm",children:"Post comment"}),e.jsx("button",{type:"button","data-mdb-button-init":!0,"data-mdb-ripple-init":!0,className:"btn btn-outline-primary btn-sm",children:"Cancel"})]})]})]})})})})}const Je=({task:l})=>{const a=W(),[r,i]=n.useState(l),[m,P]=n.useState(null),[h,x]=n.useState(""),[u,f]=n.useState(""),[N,v]=n.useState(""),[F,A]=n.useState(""),[o,p]=n.useState("");n.useState("");const[g,I]=n.useState(null);n.useState(null);const[_,H]=n.useState(0),[de,z]=n.useState(l.status==="completed"?"Task completed":"Task in progress");n.useEffect(()=>{console.log("Task Prop:",l),console.log("Current Task:",r);const s=async t=>{try{const c=(await a(ge(t))).payload;console.log("User Data:",c),P(c)}catch(d){console.error("Error fetching user:",d)}};l.taskOwner&&(console.log("Fetching user data for task owner:",l.taskOwner),s(l.taskOwner))},[l.taskOwner,r,a]),n.useEffect(()=>{console.log("User State:",m)},[m]);const E=()=>{if(l.status==="inProgress"&&l.deliverables.length===0){alert("Please add a deliverable before changing the status");return}let s="";l.status==="completed"?s="Task in progress":s="Task completed";const t={...l,status:l.status==="completed"?"inProgress":"completed"};a(V({taskId:l._id,taskData:t})),i(t),z(s)},R=s=>{Fe.error(`The ${s} field is required.`,{autoClose:3e3})},G=s=>{window.open(s,"_blank")},J=()=>{if(h==="")return R("Kpi Label");if(u==="")return R("Kpi Value");const s={...l,kpis:[...l.kpis,{label:h,count:u}]};a(V({taskId:l._id,taskData:s})),i(s)},Q=async s=>{if(s.preventDefault(),g){const t=me(he,`deliverables/${g.name}`),d=ke(t,g);d.on("state_changed",c=>{const j=c.bytesTransferred/c.totalBytes*100;H(j)},c=>{console.error("Error uploading file:",c)},async()=>{const c=await Te(d.snapshot.ref);console.log("File available at",c);const j={fileName:N,fileUrl:c};i(w=>({...w,deliverables:[...w.deliverables,j]})),v(""),I(null),H(0)})}},Z=async(s,t)=>{try{const d=me(he,t);await De(d),console.log("File deleted successfully from Firebase Storage."),i(c=>({...c,deliverables:c.deliverables.filter(j=>j.id!==s)}))}catch(d){console.error("Error deleting file:",d)}window.location.reload()},X=()=>{if(F==="")return R("Rapport Title");if(o==="")return R("Rapport Text");const s={...l,reports:[...l.reports,{label:F,count:o}]};a(V({taskId:l._id,taskData:s})),i(s)},O=s=>{const t=["primary","secondary","success","danger","warning","info","light","dark"];return t[s%t.length]},Y=s=>!isNaN(Date.parse(s)),ee=s=>Y(s)?new Date(s).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}):"",U=s=>{const t=r.kpis.filter((c,j)=>j!==s),d={...r,kpis:t};a(V({taskId:l._id,taskData:d})),window.location.reload()},C=s=>{const t=r.reports.filter((c,j)=>j!==s),d={...r,reports:t};a(V({taskId:l._id,taskData:d})),window.location.reload()};return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{}),e.jsxs(L,{children:[e.jsx(S,{children:e.jsx("div",{className:"card mb-3",style:{maxWidth:"540px"},children:e.jsxs("div",{className:"row g-0",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("img",{src:Se,alt:"Trendy Pants and Shoes",className:"img-fluid rounded-start"})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Task Details"}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Name:"})," ",r.taskName]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Owner:"})," ",m?m.username||"Unknown":"Loading..."]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Target Date:"})," ",r.endDate?ee(r.endDate):"No target date set"]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),l.status==="inProgress"?e.jsx(_e,{className:"mb-3",style:{display:l.status==="notStarted"?"none":"block"},id:"flexCheckChecked",label:"I have Completed The Task",checked:l.status==="completed",onChange:E}):e.jsxs("p",{className:" text-center text-success",children:["this Task is ",r.status]})]})})]})})}),e.jsx(S,{children:e.jsxs(k,{children:[e.jsx(D,{className:"bg-dark text-light",children:"Resources"}),e.jsx(T,{children:e.jsxs("div",{children:[e.jsxs("h5",{children:[r.taskName," Resources:"]}),e.jsx(se,{children:r.resources.map((s,t)=>e.jsx(M,{children:e.jsx(b,{href:s.url,download:!0,color:"link",children:s.fileName})},t))})]})})]})})]}),e.jsxs(k,{className:"mt-3 mb-3",children:[e.jsx(D,{className:"bg-dark text-light",children:"Sections"}),e.jsxs(T,{children:[e.jsxs(k,{className:"mt-3 mb-3",children:[e.jsx(D,{className:"bg-info text-light",children:"KPIs"}),e.jsx(T,{children:e.jsxs(se,{children:[e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center"},children:r.kpis.map((s,t)=>e.jsxs("div",{className:`card text-bg-${O(t)} mb-3`,style:{minWidth:"260px",marginRight:"10px"},children:[e.jsxs("div",{className:"card-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["KPI-",t," ",e.jsx(xe,{onClick:()=>U(t),style:{cursor:"pointer"}})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:s.label}),e.jsx("p",{className:"card-text",children:s.count})]})]},t))}),e.jsxs(M,{children:[e.jsx("label",{htmlFor:"newKpiLabel",children:"Label:"}),e.jsx(y,{id:"newKpiLabel",placeholder:"KPI Label",value:h,onChange:s=>x(s.target.value),className:"mt-3 mb-3"}),e.jsx("label",{htmlFor:"newKpiValue",children:"Value:"}),e.jsx(y,{id:"newKpiValue",placeholder:"KPI Value",value:u,onChange:s=>f(s.target.value),className:"mt-3 mb-3"}),e.jsx(b,{style:{backgroundColor:"#00cc99"},onClick:()=>J(),className:"mt-3 mb-3",children:"Add KPI"})]})]})})]}),e.jsxs(k,{className:"mt-3 mb-3",children:[e.jsx(D,{className:"bg-info text-light",children:"Documents"}),e.jsx(T,{children:e.jsxs(se,{children:[r.deliverables&&r.deliverables.map((s,t)=>e.jsx(M,{children:e.jsxs(b,{onClick:()=>G(s.fileUrl),color:"link",className:"d-flex align-items-center",children:[s.fileName,e.jsx(b,{color:"warning",className:"ms-2",children:e.jsx(Ie,{style:{fontSize:"16px"},onClick:d=>{d.stopPropagation(),Z(s.id,s.fileUrl)}})})]})},t)),e.jsx(M,{children:e.jsxs(Le,{onSubmit:Q,children:[e.jsx("label",{htmlFor:"newDeliverableName",children:"Name:"}),e.jsx(y,{id:"newDeliverableName",placeholder:"Deliverable Name",value:N,onChange:s=>v(s.target.value)}),e.jsx("label",{htmlFor:"newDeliverableFile",className:"mt-3 mb-3",children:"Upload File:"}),e.jsx("input",{id:"newDeliverableFile",name:"deliverableFile",type:"file",onChange:s=>{console.log("Selected deliverable file:",s.target.files[0]),I(s.target.files[0])}}),e.jsx(b,{style:{backgroundColor:"#00cc99"},type:"submit",className:"mt-3 mb-3",children:"Add Deliverable"}),_>0&&e.jsx(Ae,{className:"mt-2",style:{height:"20px"},children:e.jsxs(Ee,{value:_,color:"success",animated:!0,striped:!0,className:"text-center",children:[_,"%"]})})]})})]})})]}),e.jsxs(k,{className:"mt-3 mb-3",children:[e.jsx(D,{className:"bg-info text-light",children:"Reporting Section"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",padding:"20px"},children:r.reports.map((s,t)=>e.jsxs("div",{style:{minWidth:"300px",margin:"10px"},className:`card radius-10 border-start border-0 border-3 border-${O(t)} shadow`,children:[e.jsx(xe,{onClick:()=>C(t),style:{position:"absolute",top:"0",right:"0",fontSize:"20px",margin:"5px",cursor:"pointer"}}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-0 text-secondary",children:s.label}),e.jsx("p",{className:"mb-0 font-13",children:s.count})]}),e.jsx("div",{className:"widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto",children:e.jsx("i",{className:"fa fa-bar-chart"})})]})})]}))}),e.jsxs(T,{children:[e.jsx(y,{placeholder:"Title",value:F,onChange:s=>A(s.target.value),className:"mb-3"}),e.jsx(Ue,{placeholder:"Text",value:o,onChange:s=>p(s.target.value),className:"mt-3 mb-3"}),e.jsx(b,{style:{backgroundColor:"#00cc99"},onClick:()=>X(),className:"mt-3 mb-3",children:"Add Reporting Section"})]})]})]})]})]})};function Qe({selectedTask:l,setSelectedtask:a}){const r=n.useRef(null),i=h=>{const x=h.target.files[0];if(!x)return;const u={name:x.name,size:x.size};a(f=>({...f,uploadFiles:[...f.uploadFiles,u]}))},m=()=>{r.current.click()},P=h=>{a(x=>({...x,uploadFiles:x.uploadFiles.filter((u,f)=>f!==h)}))};return e.jsxs("div",{className:"upload-box",children:[e.jsxs("form",{action:"",onClick:m,children:[e.jsx("input",{type:"file",className:"file-upload-input",name:"file",hidden:!0,ref:r,onChange:i}),e.jsx("div",{className:"icon",children:e.jsx(Ke,{className:"cloud-icon",style:{color:"#0c77ad"}})}),e.jsx("p",{children:"Browse File To Upload"})]}),e.jsx("section",{className:"uploaded-area",children:l.uploadFiles.map((h,x)=>e.jsx("li",{className:"row",onClick:()=>P(x),children:e.jsxs("div",{className:"content-upload",children:[e.jsx("i",{children:e.jsx(He,{})}),e.jsx("div",{className:"details",children:e.jsx("span",{className:"name",children:h.name})})]})},x))})]})}function Ze({visible:l,setVisible:a,selectedTask:r,setSelectedtask:i}){return e.jsxs(ie,{visible:l,onClose:()=>a(!1),"aria-labelledby":"LiveDemoExampleLabel",backdrop:"static",children:[e.jsx(ce,{closeButton:!0,children:e.jsx(ne,{id:"LiveDemoExampleLabel",children:"Edit Card"})}),e.jsxs(oe,{style:{height:"450px",overflow:"auto"},className:"modal-body",children:[e.jsx("div",{className:"mb-3",children:e.jsx(y,{type:"text",id:"taskTitle",placeholder:"Task Title","aria-describedby":"taskTitleHelpInline",value:r.taskName})}),e.jsx("div",{className:"mb-3",children:e.jsx(y,{type:"date",id:"taskDate",placeholder:"Task Date",value:r.targetDate})})]}),e.jsxs(be,{children:[e.jsx(b,{color:"danger",children:"cancel"}),e.jsx(b,{color:"primary",children:"Save"})]})]})}function Xe(){return e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[e.jsx("div",{className:"card bg-success text-white m-2",style:{width:"300px"},children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"This is a title"}),e.jsx("p",{className:"card-text",children:"This is body text inside my Bootstrap card."})]})}),e.jsx("div",{className:"card bg-danger text-white m-2",style:{width:"300px"},children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"This is a title"}),e.jsx("p",{className:"card-text",children:"This is body text inside my Bootstrap card."})]})}),e.jsx("div",{className:"card bg-warning text-white m-2",style:{width:"300px"},children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"This is a title"}),e.jsx("p",{className:"card-text",children:"This is body text inside my Bootstrap card."})]})}),e.jsx("div",{className:"card bg-secondarytext-white m-2",style:{width:"300px"},children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"This is a title"}),e.jsx("p",{className:"card-text",children:"This is body text inside my Bootstrap card."})]})})]})}function Ye({open:l,setOpen:a,selectedTask:r}){const i=()=>{a(!1)};return e.jsxs(ie,{fullscreen:!0,visible:l,onClose:i,"aria-labelledby":"FullscreenExample1",children:[e.jsx(ce,{children:e.jsx(ne,{id:"FullscreenExample1",children:r.title})}),e.jsxs(oe,{style:{backgroundColor:"#eee"},children:[e.jsxs(L,{className:"mb-0",children:[e.jsx(S,{xs:12,md:6,children:e.jsx(Xe,{selectedTask:r})}),e.jsx(S,{xs:12,md:6,children:e.jsx(Qe,{})})]}),e.jsx(L,{className:"mb-0",children:e.jsx(Ge,{})})]})]})}function es({open:l,setOpen:a,handleAddTask:r,activity:i}){const[m,P]=n.useState(""),[h,x]=n.useState(""),[u,f]=n.useState(""),[N,v]=n.useState(""),F=K(o=>o.usersSlice.users),A=o=>{if(o.preventDefault(),!m||!h||!u||!N)alert("All fields are required");else{const p=new Date;p.setHours(0,0,0,0);const g=new Date(h);g.setHours(0,0,0,0);const I={taskName:m,startDate:h,endDate:u,status:g>p?"notStarted":"inProgress",color:g>p?"blue":"pink",taskOwner:N};r(I),a(!1)}};return e.jsx(e.Fragment,{children:e.jsxs(ie,{visible:l,onClose:()=>a(!1),"aria-labelledby":"LiveDemoExampleLabel",backdrop:"static",children:[e.jsx(ce,{onClose:()=>a(!1),children:e.jsx(ne,{id:"LiveDemoExampleLabel",children:"Add Task"})}),e.jsxs(oe,{children:[e.jsx(y,{label:"Task Name:",className:"mb-3",type:"text",id:"name",name:"name",placeholder:"Task Name",value:m,onChange:o=>P(o.target.value)}),e.jsxs(te,{className:"mb-3",children:[e.jsx(ue,{id:"basic-addon2",children:"Start Date"}),e.jsx(y,{type:"date",id:"start date",placeholder:"Enter start date",value:h,onChange:o=>x(o.target.value)})]}),e.jsxs(te,{className:"mb-3",children:[e.jsx(ue,{id:"basic-addon2",children:"End Date"}),e.jsx(y,{type:"date",id:"end date",placeholder:"Enter end date",value:u,onChange:o=>f(o.target.value)})]}),e.jsx(te,{className:"mb-3",children:e.jsxs(Oe,{"aria-label":"The Task Owner",onChange:o=>v(o.target.value),value:N,children:[e.jsx("option",{children:"Choose The Task Owner"}),F.map(o=>e.jsx("option",{value:o._id,children:o.username},o._id))]})})]}),e.jsxs(be,{children:[e.jsx(b,{color:"danger",onClick:()=>a(!1),children:"Close"}),e.jsx(b,{color:"primary",onClick:A,children:"Add"})]})]})})}function ss({activity:l,tasks:a}){const r=fe(),i=W(),[m,P]=n.useState(!1),[h,x]=n.useState(!1),[u,f]=n.useState(null),[N,v]=n.useState(!1),[F,A]=n.useState({}),o=4,[p,g]=n.useState(1);n.useEffect(()=>{const s=async()=>{const t={},d=[];for(const c of a)if(!t[c.taskOwner]){console.log(`Fetching user details for user ID: ${c.taskOwner}`);const j=I(c.taskOwner).then(w=>{w?(t[c.taskOwner]=w.username,console.log("Fetched user details:",w)):console.log(`No user details found for user ID: ${c.taskOwner}`)}).catch(w=>{console.error("Error fetching user details:",w)});d.push(j)}await Promise.all(d),A(t),console.log("Updated user names map:",t)};a.length>0&&s()},[a]);const I=async s=>{try{const t=await i(ge(s));return console.log("Dispatch result:",t),t.payload}catch(t){return console.error("Error fetching user details:",t),null}},_=p*o,H=_-o,de=a.slice(H,_),z=s=>{g(s)},E=Math.ceil(a.length/o),R=()=>{p>1&&g(p-1)},G=()=>{p<E&&g(p+1)},J=s=>{const t={...s,xpPoints:0,resources:[],deliverables:[],kpis:[],activityId:l._id};console.log(t),i(Ne(t)),v(!1)},Q=()=>a.filter(s=>s.status==="valid").length,Z=()=>a.filter(s=>s.status==="inProgress").length,X=()=>a.filter(s=>s.status==="completed").length,O=()=>a.filter(s=>s.status==="notStarted").length,Y=()=>a.filter(s=>s.status==="cancelled").length,ee=()=>a.filter(s=>s.status==="expired").length,U=s=>{const t=window.location.pathname;r(`${t}/${s._id}`)},C=({status:s,tasks:t,color:d})=>e.jsx(S,{xs:12,md:4,children:e.jsxs(k,{className:"mb-3 card",style:{height:"400px"},children:[e.jsx(D,{className:"text-light",style:{backgroundColor:d,display:"flex",alignItems:"center",justifyContent:"space-between"},children:s}),e.jsx(T,{style:{overflow:"auto"},children:t.map((c,j)=>c.status===s?e.jsx("div",{className:"Card_into_card",children:e.jsxs("div",{onClick:()=>U(c),className:"card border border-success shadow mb-3",style:{maxWidth:"400px",cursor:"pointer"},children:[e.jsx("div",{className:"card-header",children:e.jsx("strong",{children:c.taskName})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"text-muted mb-2",children:[e.jsx(ae,{icon:ze,className:"mr-1"}),"Assigned to: ",F[c.taskOwner]||"Loading..."]}),e.jsxs("div",{className:"text-muted mb-2",children:[e.jsx(ae,{icon:je,className:"mr-1"}),"Start Date: ",new Date(c.startDate).toLocaleDateString()]}),e.jsxs("div",{className:"text-muted mb-2",children:[e.jsx(ae,{icon:je,className:"mr-1"}),"End Date: ",new Date(c.endDate).toLocaleDateString()]}),e.jsx("div",{className:"text-muted",children:c.description})]})]})},j):null)})]})});return e.jsxs(e.Fragment,{children:[N&&e.jsx(es,{setOpen:v,open:N,handleAddTask:J,activity:l}),e.jsxs(Re,{style:{padding:"20px"},className:"mt-4",children:[u&&e.jsx(Ze,{visible:m,setVisible:P,selectedTask:u,setSelectedtask:f}),u&&e.jsx(Ye,{open:h,setOpen:x,selectedTask:u}),e.jsx(L,{children:e.jsx(S,{children:e.jsx(b,{onClick:()=>v(!0),className:"mb-3",rounded:"lg",color:"primary",style:{float:"right"},children:"Add Task"})})}),e.jsxs(L,{className:"mb-3",children:[e.jsx(C,{status:"notStarted",tasks:a,color:"#006666"}),e.jsx(C,{status:"inProgress",tasks:a,color:"#fb5858"}),e.jsx(C,{status:"completed",tasks:a,color:"#0ca279"}),e.jsx(C,{status:"valid",tasks:a,color:"#074a38"}),e.jsx(C,{status:"expired",tasks:a,color:"#dab600"}),e.jsx(C,{status:"cancelled",tasks:a,color:"grey"})]}),e.jsxs(L,{children:[e.jsx(S,{children:e.jsxs(k,{className:"mb-3",children:[e.jsx(D,{className:"bg-dark text-light",children:"Recent Tasks"}),e.jsxs(T,{children:[e.jsx("style",{children:`
                    .table-row:hover {
                      cursor: pointer; /* Change the cursor to pointer */
                      transform: scale(1.05); /* Slightly increase the size */
                      transition: transform 0.8s ease; /* Smooth transition */
                      background-color: #e0e0e0; /* Change the background color on hover */
                      transition: background-color 0.8s ease; /* Smooth transition */
                    }
                    .Card_into_card:hover .card {
                      transform: scale(1.05); /* Slightly increase the size */
                      transition: transform 0.3s ease; /* Smooth transition */
                    }
                    
                  `}),e.jsxs(Me,{striped:!0,responsive:!0,className:"text-center",children:[e.jsx($e,{children:e.jsxs(pe,{children:[e.jsx($,{scope:"col",children:"Target Date"}),e.jsx($,{scope:"col",children:"Task Name"}),e.jsx($,{scope:"col",children:"Status"}),e.jsx($,{scope:"col",children:"View"})]})}),e.jsx(qe,{children:de.map((s,t)=>e.jsxs(pe,{onClick:()=>U(s),className:"table-row rows_of_table",children:[e.jsx(q,{children:new Date(s.endDate).toLocaleDateString()}),e.jsx(q,{children:s.taskName}),e.jsx(q,{children:s.status}),e.jsx(q,{children:e.jsx(Ve,{role:"button",style:{fontSize:"25px",color:"#4CAF50"},onClick:d=>{d.stopPropagation(),U(s)}})})]},t))})]}),e.jsxs(We,{align:"center",children:[e.jsx(le,{onClick:R,disabled:p<=1,"aria-label":"Previous",children:"Previous"}),Array.from({length:E},(s,t)=>e.jsx(le,{active:t+1===p,onClick:()=>z(t+1),children:t+1},t)),e.jsx(le,{onClick:G,disabled:p>=E,"aria-label":"Next",children:"Next"})]})]})]})}),e.jsx(S,{children:e.jsxs(k,{className:"mb-3",children:[e.jsx(D,{className:"bg-dark text-light",children:"Task Progress"}),e.jsx(T,{children:e.jsx(Be,{type:"bar",data:{labels:["Total Tasks","In Progress","Completed","Valid","Expired","Cancelled","Not Started"],datasets:[{label:"Task Progress",backgroundColor:["pink","lightgreen","green","yellow","grey","blue"],data:[a.length,Z(),X(),Q(),ee(),Y(),O()]}]},labels:"Status",options:{plugins:{legend:{labels:{color:"#adb7c5"}}},scales:{x:{grid:{color:"#adb7c5"},ticks:{color:"#adb7c5"}},y:{grid:{color:"#adb7c5"},ticks:{color:"#adb7c5"}}}}})})]})})]})]})]})}function as({activity:l}){const a=W(),r=K(i=>i.task.tasksByActivityId);return n.useEffect(()=>{a(ye(l._id))},[a,l._id]),e.jsxs(re,{children:[e.jsx(B,{path:"/",element:e.jsx(ss,{activity:l,tasks:r})}),r.map(i=>e.jsx(B,{path:`${i._id}/*`,element:e.jsx(Je,{task:i})},i._id))]})}const ts=({program:l})=>{console.log("ProgramWithActivities rendered");const a=W(),r=K(i=>i.activity.activitiesByProgramId||[]);return n.useEffect(()=>{a(ve(l._id)).then(i=>{i!=null&&i.payload&&a(Ce(i.payload.map(m=>({path:`/Monitoring/${encodeURIComponent(l._id)}/${encodeURIComponent(m._id)}`,name:m.name,activityId:m._id}))))})},[a,l._id,l.programTitle]),e.jsxs(re,{children:[e.jsx(B,{path:"/",element:e.jsx(we,{activities:r,program:l})}),r.map(i=>e.jsx(B,{path:`${i._id}/*`,element:e.jsx(as,{activity:i})},i._id))]})},Es=()=>{const l=K(a=>a.programsSlice.programs);return e.jsx(re,{children:l.map(a=>e.jsx(B,{name:a.programTitle,path:`/${a._id}/*`,element:e.jsx(ts,{program:a})},a._id))})};export{Es as default};
