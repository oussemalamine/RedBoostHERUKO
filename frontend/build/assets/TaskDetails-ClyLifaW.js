import{X as ee,r as l,n as se,j as e,Y as ae,K as te,M as m}from"./index-C8diSxJB.js";import{r as L,s as U,u as re,g as le,d as oe}from"./firebase-DfqT8Rqk.js";import{i as ne,C as D,I as E}from"./index-BFW_OZiL.js";import{Q as ie,B as ce}from"./ReactToastify-CywJzNmS.js";import{F as de}from"./index-Dio9L0x0.js";import{C as me,a as B}from"./CRow-BLE2Ph6C.js";import{C as he}from"./CFormCheck-BdWIrEfk.js";import{C as h,a as p}from"./CCardBody-CrmRxOrF.js";import{C as u}from"./CCardHeader-B8sPIN-d.js";import{C as f}from"./CListGroupItem-C8JO_jfS.js";import{a as d}from"./index.esm-14PgRZM7.js";import{C as j}from"./CFormInput-Cy6DlF7x.js";import{C as pe}from"./CForm-B6uC-7r3.js";import{C as ue,a as xe}from"./DefaultLayout-C4vGQpA-.js";import{C as ge}from"./CFormTextarea-3JMbwrs6.js";import"./iconBase-DEK5PW2A.js";import"./CFormControlWrapper-5hdytq66.js";import"./isObject-gWhhM0FN.js";import"./cil-user-Ddrdy7PS.js";const Ee=()=>{const{taskId:T}=ee(),[t,_]=l.useState(null),c=se(),[r,b]=l.useState(t||{}),[x,V]=l.useState(null),[N,A]=l.useState(""),[k,O]=l.useState(""),[S,I]=l.useState(""),[w,W]=l.useState(""),[C,$]=l.useState("");l.useState("");const[y,F]=l.useState(null);l.useState(null);const[v,R]=l.useState(0);if(l.useEffect(()=>{b(t||{})},[t]),l.useEffect(()=>{(async()=>{try{const a=await ae.post("https://redboost-65f83dc8cbf1.herokuapp.com/loadTaskById",{taskId:T});console.log("Task details fetched successfully:",a.data),_(a.data)}catch(a){console.error("Error fetching task details:",a)}})()},[T]),l.useEffect(()=>{const s=async a=>{try{const n=(await c(te(a))).payload;console.log("User Data:",n),V(n)}catch(o){console.error("Error fetching user:",o)}};t&&t.taskOwner&&(console.log("Fetching user data for task owner:",t.taskOwner),s(t.taskOwner))},[t,c]),l.useEffect(()=>{console.log("User State:",x)},[x]),!t)return e.jsx("div",{children:"Loading..."});const z=()=>{if(t.status==="inProgress"&&t.deliverables.length===0){alert("Please add a deliverable before changing the status");return}const s=t.status==="completed"?"inProgress":"completed",a={...t,status:s};c(m({taskId:t._id,taskData:a})),window.location.reload()},g=s=>{ce.error(`The ${s} field is required.`,{autoClose:3e3})},G=s=>{window.open(s,"_blank")},q=()=>{if(N==="")return g("KPI Label");if(k==="")return g("KPI Value");const s={...t,kpis:[...t.kpis,{label:N,count:k}]};c(m({taskId:t._id,taskData:s})),window.location.reload()},H=async s=>{if(s.preventDefault(),y){const a=L(U,`deliverables/${y.name}`),o=re(a,y);o.on("state_changed",n=>{const i=n.bytesTransferred/n.totalBytes*100;R(i)},n=>{console.error("Error uploading file:",n)},async()=>{const n=await le(o.snapshot.ref);console.log("File available at",n);const i={fileName:S,fileUrl:n};b(P=>({...P,deliverables:[...P.deliverables,i]})),I(""),F(null),R(0)})}},M=async(s,a)=>{try{const o=L(U,a);await oe(o),console.log("File deleted successfully from Firebase Storage."),b(n=>({...n,deliverables:n.deliverables.filter(i=>i.id!==s)}))}catch(o){console.error("Error deleting file:",o)}window.location.reload()},Q=s=>{const a=r.reports.filter((n,i)=>i!==s),o={...r,reports:a};c(m({taskId:t._id,taskData:o})),window.location.reload()},X=()=>{if(w==="")return g("Rapport Title");if(C==="")return g("Rapport Text");const s={...t,reports:[...t.reports,{label:w,count:C}]};c(m({taskId:t._id,taskData:s})),window.location.reload()},Y=s=>{const a=r.kpis.filter((n,i)=>i!==s),o={...r,kpis:a};c(m({taskId:t._id,taskData:o})),window.location.reload()},K=s=>{const a=["primary","secondary","success","danger","warning","info","light","dark"];return a[s%a.length]},J=s=>!isNaN(Date.parse(s)),Z=s=>J(s)?new Date(s).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}):"";return e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),e.jsxs(me,{children:[e.jsx(B,{children:e.jsx("div",{className:"card mb-3",style:{maxWidth:"540px"},children:e.jsxs("div",{className:"row g-0",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("img",{src:ne,alt:"Trendy Pants and Shoes",className:"img-fluid rounded-start"})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Task Details"}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Name:"})," ",r.taskName]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Owner:"})," ",x?x.username||"Unknown":"Loading..."]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Target Date:"})," ",r.endDate?Z(r.endDate):"No target date set"]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),r.status==="inProgress"?e.jsx(he,{className:"mb-3",style:{display:t.status==="notStarted"?"none":"block"},id:"flexCheckChecked",label:"I have Completed The Task",checked:t.status==="completed",onChange:z}):e.jsxs("p",{className:" text-center text-success",children:["this Task is ",r.status]})]})})]})})}),e.jsx(B,{children:e.jsxs(h,{children:[e.jsx(u,{className:"bg-dark text-light",children:"Resources"}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsxs("h5",{children:[r.taskName," Resources:"]}),e.jsx(D,{children:r.resources&&r.resources.map((s,a)=>e.jsx(f,{children:e.jsx(d,{href:s.url,download:!0,color:"link",children:s.fileName})},a))})]})})]})})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-dark text-light",children:"Sections"}),e.jsxs(p,{children:[e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"KPIs"}),e.jsx(p,{children:e.jsxs(D,{children:[e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center"},children:r.kpis&&r.kpis.map((s,a)=>e.jsxs("div",{className:`card text-bg-${K(a)} mb-3`,style:{minWidth:"260px",marginRight:"10px"},children:[e.jsxs("div",{className:"card-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["KPI-",a," ",e.jsx(E,{onClick:()=>Y(a),style:{cursor:"pointer"}})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:s.label}),e.jsx("p",{className:"card-text",children:s.count})]})]},a))}),e.jsxs(f,{children:[e.jsx("label",{htmlFor:"newKpiLabel",children:"Label:"}),e.jsx(j,{id:"newKpiLabel",placeholder:"KPI Label",value:N,onChange:s=>A(s.target.value),className:"mt-3 mb-3"}),e.jsx("label",{htmlFor:"newKpiValue",children:"Value:"}),e.jsx(j,{id:"newKpiValue",placeholder:"KPI Value",value:k,onChange:s=>O(s.target.value),className:"mt-3 mb-3"}),e.jsx(d,{style:{backgroundColor:"#00cc99"},onClick:()=>q(),className:"mt-3 mb-3",children:"Add KPI"})]})]})})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"Documents"}),e.jsx(p,{children:e.jsxs(D,{children:[r.deliverables&&r.deliverables.map((s,a)=>e.jsx(f,{children:e.jsxs(d,{onClick:()=>G(s.fileUrl),color:"link",className:"d-flex align-items-center",children:[s.fileName,e.jsx(d,{color:"warning",className:"ms-2",children:e.jsx(de,{style:{fontSize:"16px"},onClick:o=>{o.stopPropagation(),M(s.id,s.fileUrl)}})})]})},a)),e.jsx(f,{children:e.jsxs(pe,{onSubmit:H,children:[e.jsx("label",{htmlFor:"newDeliverableName",children:"Name:"}),e.jsx(j,{id:"newDeliverableName",placeholder:"Deliverable Name",value:S,onChange:s=>I(s.target.value)}),e.jsx("label",{htmlFor:"newDeliverableFile",className:"mt-3 mb-3",children:"Upload File:"}),e.jsx("input",{id:"newDeliverableFile",name:"deliverableFile",type:"file",onChange:s=>{console.log("Selected deliverable file:",s.target.files[0]),F(s.target.files[0])}}),e.jsx(d,{style:{backgroundColor:"#00cc99"},type:"submit",className:"mt-3 mb-3",children:"Add Deliverable"}),v>0&&e.jsx(ue,{className:"mt-2",style:{height:"20px"},children:e.jsxs(xe,{value:v,color:"success",animated:!0,striped:!0,className:"text-center",children:[v,"%"]})})]})})]})})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"Reporting Section"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",padding:"20px"},children:r.reports&&r.reports.map((s,a)=>e.jsxs("div",{style:{minWidth:"300px",margin:"10px"},className:`card radius-10 border-start border-0 border-3 border-${K(a)} shadow`,children:[e.jsx(E,{onClick:()=>Q(a),style:{position:"absolute",top:"0",right:"0",fontSize:"20px",margin:"5px",cursor:"pointer"}}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-0 text-secondary",children:s.label}),e.jsx("p",{className:"mb-0 font-13",children:s.count})]}),e.jsx("div",{className:"widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto",children:e.jsx("i",{className:"fa fa-bar-chart"})})]})})]}))}),e.jsxs(p,{children:[e.jsx(j,{placeholder:"Title",value:w,onChange:s=>W(s.target.value),className:"mb-3"}),e.jsx(ge,{placeholder:"Text",value:C,onChange:s=>$(s.target.value),className:"mt-3 mb-3"}),e.jsx(d,{style:{backgroundColor:"#00cc99"},onClick:()=>X(),className:"mt-3 mb-3",children:"Add Reporting Section"})]})]})]})]})]})};export{Ee as default};
