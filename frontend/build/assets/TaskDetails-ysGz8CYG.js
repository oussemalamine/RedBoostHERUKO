import{X as se,r as l,n as ae,j as e,Y as te,K as re,M as m}from"./index-D7i1GXSH.js";import{r as R,s as F,u as le,g as oe,d as ne}from"./firebase-jsUvlEzP.js";import{i as ie,C as P,I as L}from"./index-qe5mhUKg.js";import{Q as ce,B as de}from"./react-toastify.esm-7QKpu2Dh.js";/* empty css                      */import{F as me}from"./index-B-q7jpOb.js";import{C as he,a as U}from"./CRow-BLghyscU.js";import{C as pe}from"./CFormCheck-BuXnNon6.js";import{C as h,a as p}from"./CCardBody-VsFDQUom.js";import{C as u}from"./CCardHeader-CzJwRT5k.js";import{C as E}from"./CListGroupItem-BAUnQecv.js";import{a as d}from"./index.esm-BQoNxqCC.js";import{C as g}from"./CFormInput-DgLLBXQY.js";import{C as ue}from"./CForm-b_B6yHIb.js";import{C as xe,a as je}from"./DefaultLayout-CpDzK-wa.js";import{C as ge,a as fe,b as B,c as be}from"./CTable-Dr1RvjBQ.js";import{C as ke}from"./CFormTextarea-DQmB9GzJ.js";import"./iconBase-CEnx2H4z.js";import"./CFormControlWrapper-BayNpT4r.js";import"./isObject-BFHkbZTq.js";import"./cil-user-Ddrdy7PS.js";const We=()=>{const{taskId:v}=se(),[t,V]=l.useState(null),c=ae(),[r,f]=l.useState(t||{}),[x,_]=l.useState(null),[b,A]=l.useState(""),[k,O]=l.useState(""),[T,D]=l.useState(""),[N,W]=l.useState(""),[w,$]=l.useState("");l.useState("");const[C,S]=l.useState(null);l.useState(null);const[y,I]=l.useState(0);if(l.useEffect(()=>{f(t||{})},[t]),l.useEffect(()=>{(async()=>{try{const a=await te.post("https://redboost-65f83dc8cbf1.herokuapp.com/loadTaskById",{taskId:v});console.log("Task details fetched successfully:",a.data),V(a.data)}catch(a){console.error("Error fetching task details:",a)}})()},[v]),l.useEffect(()=>{const s=async a=>{try{const n=(await c(re(a))).payload;console.log("User Data:",n),_(n)}catch(o){console.error("Error fetching user:",o)}};t&&t.taskOwner&&(console.log("Fetching user data for task owner:",t.taskOwner),s(t.taskOwner))},[t,c]),l.useEffect(()=>{console.log("User State:",x)},[x]),!t)return e.jsx("div",{children:"Loading..."});const z=()=>{if(t.status==="inProgress"&&t.deliverables.length===0){alert("Please add a deliverable before changing the status");return}const s=t.status==="completed"?"inProgress":"completed",a={...t,status:s};c(m({taskId:t._id,taskData:a})),window.location.reload()},j=s=>{de.error(`The ${s} field is required.`,{autoClose:3e3})},G=s=>{window.open(s,"_blank")},H=()=>{if(b==="")return j("KPI Label");if(k==="")return j("KPI Value");const s={...t,kpis:[...t.kpis,{label:b,count:k}]};c(m({taskId:t._id,taskData:s})),window.location.reload()},q=async s=>{if(s.preventDefault(),C){const a=R(F,`deliverables/${C.name}`),o=le(a,C);o.on("state_changed",n=>{const i=parseFloat((n.bytesTransferred/n.totalBytes*100).toFixed(2));I(i)},n=>{console.error("Error uploading file:",n)},async()=>{const n=await oe(o.snapshot.ref);console.log("File available at",n);const i={fileName:T,fileUrl:n};f(K=>({...K,deliverables:[...K.deliverables,i]})),D(""),S(null),I(0)})}},M=async(s,a)=>{try{const o=R(F,a);await ne(o),console.log("File deleted successfully from Firebase Storage."),f(n=>({...n,deliverables:n.deliverables.filter(i=>i.id!==s)}))}catch(o){console.error("Error deleting file:",o)}window.location.reload()},Q=s=>{const a=r.reports.filter((n,i)=>i!==s),o={...r,reports:a};c(m({taskId:t._id,taskData:o})),window.location.reload()},X=()=>{if(N==="")return j("Rapport Title");if(w==="")return j("Rapport Text");const s={...t,reports:[...t.reports,{label:N,count:w}]};c(m({taskId:t._id,taskData:s})),window.location.reload()},Y=s=>{const a=r.kpis.filter((n,i)=>i!==s),o={...r,kpis:a};c(m({taskId:t._id,taskData:o})),window.location.reload()},J=s=>{const a=["primary","secondary","success","danger","warning","info","light","dark"];return a[s%a.length]},Z=s=>!isNaN(Date.parse(s)),ee=s=>Z(s)?new Date(s).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}):"";return e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsxs(he,{children:[e.jsx(U,{children:e.jsx("div",{className:"card mb-3",style:{maxWidth:"540px"},children:e.jsxs("div",{className:"row g-0",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("img",{src:ie,alt:"Trendy Pants and Shoes",className:"img-fluid rounded-start"})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Task Details"}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Name:"})," ",r.taskName]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Task Owner:"})," ",x?x.username||"Unknown":"Loading..."]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Target Date:"})," ",r.endDate?ee(r.endDate):"No target date set"]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),r.status==="inProgress"?e.jsx(pe,{className:"mb-3",style:{display:t.status==="notStarted"?"none":"block"},id:"flexCheckChecked",label:"I have Completed The Task",checked:t.status==="completed",onChange:z}):e.jsxs("p",{className:" text-center text-success",children:["this Task is ",r.status]})]})})]})})}),e.jsx(U,{children:e.jsxs(h,{children:[e.jsx(u,{className:"bg-dark text-light",children:"Resources"}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsxs("h5",{children:[r.taskName," Resources:"]}),e.jsx(P,{children:r.resources&&r.resources.map((s,a)=>e.jsx(E,{children:e.jsx(d,{href:s.url,download:!0,color:"link",children:s.fileName})},a))})]})})]})})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-dark text-light",children:"Sections"}),e.jsxs(p,{children:[e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"KPIs"}),e.jsxs(p,{children:[e.jsx(E,{children:e.jsxs("div",{className:"form-group d-flex align-items-center mt-3 mb-3",children:[e.jsx("label",{htmlFor:"newKpiLabel",className:"me-2",children:"Label:"}),e.jsx(g,{id:"newKpiLabel",placeholder:"KPI Label",value:b,onChange:s=>A(s.target.value),className:"me-3",style:{maxWidth:"200px"}}),e.jsx("label",{htmlFor:"newKpiValue",className:"me-2",children:"Value:"}),e.jsx(g,{id:"newKpiValue",placeholder:"KPI Value",value:k,onChange:s=>O(s.target.value),className:"me-3",style:{maxWidth:"150px"}}),e.jsx(d,{style:{backgroundColor:"#00cc99"},onClick:()=>H(),children:"Add KPI"})]})}),e.jsx(P,{children:e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"#"}),e.jsx("th",{scope:"col",children:"KPI Label"}),e.jsx("th",{scope:"col",children:"KPI Value"}),e.jsx("th",{scope:"col",children:"Actions"})]})}),e.jsx("tbody",{children:r.kpis&&r.kpis.map((s,a)=>e.jsxs("tr",{children:[e.jsxs("th",{scope:"row",children:["KPI-",a]}),e.jsx("td",{children:s.label}),e.jsx("td",{children:s.count}),e.jsx("td",{children:e.jsx(L,{onClick:()=>Y(a),style:{cursor:"pointer",color:"red"}})})]},a))})]})})]})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"Documents"}),e.jsxs(p,{children:[e.jsxs(ue,{onSubmit:q,className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx(g,{id:"newDeliverableName",placeholder:"Deliverable Name",value:T,onChange:s=>D(s.target.value),className:"me-2"}),e.jsx("input",{id:"newDeliverableFile",name:"deliverableFile",type:"file",onChange:s=>{console.log("Selected deliverable file:",s.target.files[0]),S(s.target.files[0])},className:"me-2"}),e.jsx(d,{style:{backgroundColor:"#00cc99"},type:"submit",children:"Add Deliverable"})]}),y>0&&e.jsx(xe,{className:"mt-2 mb-3",style:{height:"20px"},children:e.jsxs(je,{value:y,color:"success",animated:!0,striped:!0,className:"text-center",children:[y,"%"]})}),e.jsxs(ge,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(fe,{children:e.jsxs(B,{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Actions"})]})}),e.jsx(be,{children:r.deliverables&&r.deliverables.map((s,a)=>e.jsxs(B,{children:[e.jsx("td",{children:s.fileName}),e.jsxs("td",{children:[e.jsx(d,{onClick:()=>G(s.fileUrl),color:"link",className:"d-inline-flex align-items-center",children:"Download"}),e.jsx(d,{color:"warning",className:"ms-2",children:e.jsx(me,{style:{fontSize:"16px"},onClick:o=>{o.stopPropagation(),M(s.id,s.fileUrl)}})})]})]},a))})]})]})]}),e.jsxs(h,{className:"mt-3 mb-3",children:[e.jsx(u,{className:"bg-info text-light",children:"Reporting Section"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",padding:"20px"},children:r.reports&&r.reports.map((s,a)=>e.jsxs("div",{style:{minWidth:"300px",margin:"10px"},className:`card radius-10 border-start border-0 border-3 border-${J(a)} shadow`,children:[e.jsx(L,{onClick:()=>Q(a),style:{position:"absolute",top:"0",right:"0",fontSize:"20px",margin:"5px",cursor:"pointer"}}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-0 text-secondary",children:s.label}),e.jsx("p",{className:"mb-0 font-13",children:s.count})]}),e.jsx("div",{className:"widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto",children:e.jsx("i",{className:"fa fa-bar-chart"})})]})})]}))}),e.jsxs(p,{children:[e.jsx(g,{placeholder:"Title",value:N,onChange:s=>W(s.target.value),className:"mb-3"}),e.jsx(ke,{placeholder:"Text",value:w,onChange:s=>$(s.target.value),className:"mt-3 mb-3"}),e.jsx(d,{style:{backgroundColor:"#00cc99"},onClick:()=>X(),className:"mt-3 mb-3",children:"Add Reporting Section"})]})]})]})]})]})};export{We as default};
