import{r as d,R as _,n as M,j as e,K as P,a5 as Q,h as T,a6 as W,H as Y}from"./index-TUUzSIEo.js";import{c as Z}from"./index-BtuUtWFQ.js";import{H as ee}from"./index-DSj3W9gj.js";import{C as I,D as se,A as te,p as ae,a as re}from"./chart-C4pU69U9.js";import{G as ne}from"./iconBase-ClQ3GV-T.js";import{C as le,a as ie,b as ce,c as oe,d as de}from"./DefaultLayout-DQhq-n-e.js";import{C as S}from"./CFormInput-DJgB3Zd_.js";import{C as ue}from"./CFormSelect-BE1aixc6.js";import{a as v}from"./index.es-VxSNoJNI.js";import{C as E,a as H}from"./CCardBody-DlEs3i2P.js";import{C as pe}from"./CCardHeader-kC1gq54C.js";import{C as he,a as me,b as L,e as m,d as xe}from"./CTable-cExTQUab.js";import"./isObject-7kIYeA6F.js";import"./cil-user-Ddrdy7PS.js";const V="label";function O(a,r){typeof a=="function"?a(r):a&&(a.current=r)}function fe(a,r){const t=a.options;t&&r&&Object.assign(t,r)}function B(a,r){a.labels=r}function z(a,r){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:V;const x=[];a.datasets=r.map(i=>{const o=a.datasets.find(g=>g[t]===i[t]);return!o||!i.data||x.includes(o)?{...i}:(x.push(o),Object.assign(o,i),o)})}function ge(a){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:V;const t={labels:[],datasets:[]};return B(t,a.labels),z(t,a.datasets,r),t}function je(a,r){const{height:t=150,width:x=300,redraw:i=!1,datasetIdKey:o,type:g,data:p,options:l,plugins:k=[],fallbackContent:C,updateMode:n,...u}=a,j=d.useRef(null),c=d.useRef(),b=()=>{j.current&&(c.current=new I(j.current,{type:g,data:ge(p,o),options:l&&{...l},plugins:k}),O(r,c.current))},y=()=>{O(r,null),c.current&&(c.current.destroy(),c.current=null)};return d.useEffect(()=>{!i&&c.current&&l&&fe(c.current,l)},[i,l]),d.useEffect(()=>{!i&&c.current&&B(c.current.config.data,p.labels)},[i,p.labels]),d.useEffect(()=>{!i&&c.current&&p.datasets&&z(c.current.config.data,p.datasets,o)},[i,p.datasets]),d.useEffect(()=>{c.current&&(i?(y(),setTimeout(b)):c.current.update(n))},[i,l,p.labels,p.datasets,n]),d.useEffect(()=>{c.current&&(y(),setTimeout(b))},[g]),d.useEffect(()=>(b(),()=>y()),[]),_.createElement("canvas",Object.assign({ref:j,role:"img",height:t,width:x},u),C)}const Ce=d.forwardRef(je);function be(a,r){return I.register(r),d.forwardRef((t,x)=>_.createElement(Ce,Object.assign({},t,{ref:x,type:a})))}const ve=be("doughnut",se);function ye(a){return ne({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M152.1 38.2c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 113C-2.3 103.6-2.3 88.4 7 79s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zm0 160c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 273c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zM224 96c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zM160 416c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H192c-17.7 0-32-14.3-32-32zM48 368a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"},child:[]}]})(a)}function ke({showModal:a,setShowModal:r,selectedTask:t,setSelectedTask:x}){const i=M(),o=n=>{const{name:u,value:j}=n.target,c={...t,[u]:j};x(c)},g=()=>{const{_id:n,...u}=t;i(P({taskId:n,taskData:u})),r(!1)},p=()=>{i(Q(t._id)),r(!1)},l=()=>{i(P({taskId:t._id,taskData:{...t,status:"valid"}})),r(!1)},k=n=>!isNaN(Date.parse(n)),C=n=>k(n)?new Date(n).toISOString().substring(0,10):"";return e.jsxs(le,{visible:a,onClose:()=>r(!1),"aria-labelledby":"LiveDemoExampleLabel",backdrop:"static",children:[e.jsx(ie,{closeButton:!0,children:e.jsx(ce,{id:"LiveDemoExampleLabel",children:"View Task"})}),e.jsxs(oe,{style:{height:"450px",overflow:"auto"},className:"modal-body",children:[e.jsx("div",{className:"mb-3",children:e.jsx(S,{type:"text",id:"taskTitle",name:"taskName",placeholder:"Task Title","aria-describedby":"taskTitleHelpInline",value:t.taskName,onChange:o,disabled:!0})}),e.jsx("div",{className:"mb-3",children:e.jsxs(ue,{value:t.status,id:"taskStatus",name:"status",onChange:o,className:t.status==="valid"?"status-valid":t.status==="completed"?"status-completed":"",children:[e.jsx("option",{value:"inProgress",children:"In Progress"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"valid",children:"Validated"})]})}),e.jsx("div",{className:"mb-3",children:e.jsx(S,{value:C(t.targetDate),type:"date",name:"targetDate",id:"taskDate",placeholder:"Task Date",onChange:o,disabled:!0})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"xpPoints",className:"form-label",children:"Enter your XP points score !!!!"}),e.jsx(S,{value:t.xpPoints,type:"number",name:"xpPoints",id:"xpPoints",placeholder:"XP Points",onChange:o})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{children:"Task Evidence"}),e.jsxs("div",{className:"Kpis",children:[e.jsx("h6",{children:"Kpi's"}),t.kpis?t.kpis.length>0?e.jsx("ul",{children:t.kpis.map((n,u)=>e.jsx("li",{children:e.jsxs("a",{target:"_blank",rel:"noopener noreferrer",children:[n.label," = ",n.count]})},u))}):e.jsx("p",{children:"No attachments found."}):e.jsx("p",{children:"Couldn't access the kpi's of this task."})]}),e.jsxs("div",{className:"Reports",children:[e.jsx("h6",{children:"Reports"}),t.reports?t.reports.length>0?e.jsx("ul",{children:t.reports.map((n,u)=>e.jsx("li",{children:e.jsxs("a",{target:"_blank",rel:"noopener noreferrer",children:[n.label," = ",n.count]})},u))}):e.jsx("p",{children:"No attachments found."}):e.jsx("p",{children:"Couldn't access the reports of this task."})]}),e.jsxs("div",{className:"Deliverables",children:[e.jsx("h6",{children:"Deliverables"}),t.deliverables?t.deliverables.length>0?e.jsx("ul",{children:t.deliverables.map((n,u)=>e.jsx("li",{children:e.jsx("a",{href:n.fileUrl,target:"_blank",rel:"noopener noreferrer",children:n.fileName})},u))}):e.jsx("p",{children:"No attachments found."}):e.jsx("p",{children:"Couldn't access the deliverables of this task."})]})]})]}),e.jsxs(de,{children:[e.jsx(v,{color:"danger",onClick:p,children:"Delete"}),e.jsx(v,{color:"secondary",onClick:()=>r(!1),children:"Close"}),e.jsx(v,{color:"primary",onClick:g,children:"Save"}),e.jsx(v,{color:"success",onClick:l,children:"Validate"})]})]})}I.register(te,ae,re);const Be=()=>{const[a,r]=d.useState("all"),[t,x]=d.useState(!1),[i,o]=d.useState(null),[g,p]=d.useState(""),[l,k]=d.useState(null),[C,n]=d.useState("asc"),u=M(),j=T(s=>s.usersSlice.users),b=T(s=>s.task.allTasks).filter(s=>s.status==="completed"||s.status==="valid"||s.status==="cancelled"),y=T(s=>s.userData.userData),F=s=>{o(s),x(!0)},K=s=>{const h=j.find(f=>f._id===s.taskOwner);u(P({taskId:s._id,taskData:{...s,status:"valid"}})),u(W({userId:s.taskOwner,userData:{exp:s.xpPoints+Number(h.exp)}})),s.taskOwner===y._id&&u(Y({...y,exp:s.xpPoints+Number(y.exp)}))},$=()=>b.filter(s=>s.status==="completed").length,A=()=>b.filter(s=>s.status==="cancelled").length,U={labels:["Valid","Completed","Cancelled"],datasets:[{label:"Tasks",data:[b.filter(s=>s.status==="valid").length,$(),A()],backgroundColor:["#28a745","blue","gray"]}]},G={responsive:!0,plugins:{legend:{position:"bottom"}}},X=s=>{switch(s){case"inProgress":return"bg-warning";case"expired":return"bg-danger";case"valid":return"bg-success";case"cancelled":return"bg-secondary";default:return"bg-info"}},R=b.filter(s=>{var w;const h=g.toLowerCase(),f=s.status.toLowerCase();return a==="valid"?f==="valid":a==="completed"?f==="completed":a==="cancelled"?f==="cancelled":s.taskName.toLowerCase().includes(h)||((w=j.find(J=>J._id===s.taskOwner))==null?void 0:w.username.toLowerCase().includes(h))||f.includes(h)||s.xpPoints.toString().includes(h)||s.targetDate.includes(h)}),D=s=>{l===s?n(C==="asc"?"desc":"asc"):(k(s),n("asc"))},N=s=>{if(l===s)return C==="asc"?e.jsx("span",{children:"↑"}):e.jsx("span",{children:"↓"})},q=l?R.slice().sort((s,h)=>s[l]<h[l]?C==="asc"?-1:1:s[l]>h[l]?C==="asc"?1:-1:0):R;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[i&&e.jsx(ke,{showModal:t,setShowModal:x,selectedTask:i,setSelectedTask:o}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[e.jsx(v,{className:`btn ${a==="all"?"btn-primary":"btn-secondary"}`,onClick:()=>r("all"),children:"All"}),e.jsx(v,{className:`btn ${a==="valid"?"btn-primary":"btn-secondary"}`,onClick:()=>r("valid"),children:"Valid"}),e.jsx(v,{className:`btn ${a==="completed"?"btn-primary":"btn-secondary"}`,onClick:()=>r("completed"),children:"Completed"}),e.jsx(v,{className:`btn ${a==="cancelled"?"btn-primary":"btn-secondary"}`,onClick:()=>r("cancelled"),children:"Cancelled"})]}),e.jsxs(E,{children:[e.jsxs(pe,{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ye,{style:{marginRight:"10px"}}),"Task List"]}),e.jsx(S,{type:"text",placeholder:"Search Task",value:g,onChange:s=>p(s.target.value),style:{marginTop:"10px",width:"300px"}})]}),e.jsx(H,{style:{maxHeight:"500px",overflow:"auto"},children:e.jsxs(he,{responsive:!0,hover:!0,children:[e.jsx(me,{children:e.jsxs(L,{children:[e.jsxs(m,{onClick:()=>D("taskName"),children:["Task ",l==="taskName"&&N("taskName")]}),e.jsxs(m,{onClick:()=>D("username"),children:["Team Member ",l==="username"&&N("username")]}),e.jsxs(m,{onClick:()=>D("status"),children:["Status ",l==="status"&&N("status")]}),e.jsxs(m,{onClick:()=>D("xpPoints"),children:["Points ",l==="xpPoints"&&N("xpPoints")]}),e.jsxs(m,{onClick:()=>D("targetDate"),children:["Release Date ",l==="targetDate"&&N("targetDate")]}),e.jsx(m,{children:"Actions"})]})}),e.jsx(xe,{children:q.map((s,h)=>{const f=j.find(w=>w._id===s.taskOwner);return e.jsxs(L,{children:[e.jsx(m,{children:s.taskName}),e.jsx(m,{children:e.jsx("span",{className:"ms-2",children:f==null?void 0:f.username})}),e.jsx(m,{children:e.jsx("span",{className:`badge ${X(s.status)}`,children:s.status})}),e.jsxs(m,{children:[s.xpPoints,"XP"]}),e.jsx(m,{children:new Date(s.targetDate).toLocaleDateString()}),e.jsxs(m,{children:[s.status!=="valid"&&e.jsx(Z,{onClick:()=>K(s),style:{color:"green",fontSize:"25px",cursor:"pointer",marginRight:"10px"}}),e.jsx(ee,{onClick:()=>F(s),style:{color:"blue",fontSize:"25px",cursor:"pointer"}})]})]},h)})})]})})]}),e.jsx(E,{children:e.jsx(H,{style:{maxHeight:"400px",padding:"10px"},children:e.jsx(ve,{style:{margin:"0 auto"},data:U,options:G})})})]})};export{Be as default};
